<h1 id="lecture-5-kotlin-worksheet">Lecture 5: Kotlin Worksheet</h1>
<h2 id="quiz-section">Quiz Section</h2>
<h3 id="question-1">Question 1</h3>
<p>Complete the following definition by filling in the blanks:</p>
<p>A code smell is a __________ indication that usually corresponds to a
deeper __________ in the system. It’s not a __________ but rather a
warning sign that something in your code __________ could be
improved.</p>
<p><strong>Word Bank:</strong> bug, surface, problem, design</p>
<hr />
<h3 id="question-2">Question 2</h3>
<p>Fill in the blanks to complete this statement about refactoring:</p>
<p>Refactoring is the process of improving your code’s __________
structure without changing its __________ behavior. The key principle is
to make __________ changes that can be easily __________.</p>
<p><strong>Word Bank:</strong> external, internal, incremental,
verified</p>
<hr />
<h3 id="question-3">Question 3</h3>
<p>Complete the following statement about the relationship between
testing and refactoring:</p>
<p>Unit tests enable __________ refactoring because with a comprehensive
test __________, you can refactor confidently knowing that if you break
something, the tests will __________ it. Tests should still __________
after refactoring.</p>
<p><strong>Word Bank:</strong> suite, safe, catch, pass</p>
<hr />
<h3 id="question-4">Question 4</h3>
<p>Which of the following is NOT a characteristic of the “Long Method”
code smell?</p>
<ol type="A">
<li>The method tries to do too many things<br />
</li>
<li>The method is difficult to test all different paths<br />
</li>
<li>The method has too few parameters<br />
</li>
<li>The method violates the Single Responsibility Principle</li>
</ol>
<hr />
<h3 id="question-5">Question 5</h3>
<p>When should you use the “Extract Method” refactoring technique?</p>
<ol type="A">
<li>When a method is too short and needs more functionality<br />
</li>
<li>When you have code fragments that can be grouped together or when a
method is too long and complex<br />
</li>
<li>When you want to make all methods public<br />
</li>
<li>When you need to add more parameters to a method</li>
</ol>
<hr />
<h3 id="question-6">Question 6</h3>
<p>What is the primary benefit of the “Replace Type Code with Class”
refactoring?</p>
<ol type="A">
<li>It makes the code run faster<br />
</li>
<li>It reduces the number of classes in the system<br />
</li>
<li>It provides type safety and prevents invalid values from being
used<br />
</li>
<li>It eliminates the need for enums in Kotlin</li>
</ol>
<hr />
<h2 id="task-section">Task Section</h2>
<h3 id="task-1-refactor-duplicated-code">Task 1: Refactor Duplicated
Code</h3>
<p>The following code contains duplicated validation logic. Your task is
to refactor it by extracting the duplicated code into separate
methods.</p>
<p><strong>Starting Code:</strong></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProductManager <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">val</span> <span class="va">products</span> <span class="op">=</span> mutableListOf<span class="op">&lt;</span>Pair<span class="op">&lt;</span><span class="kw">String</span><span class="op">,</span> <span class="kw">Double</span><span class="op">&gt;&gt;()</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fun</span> <span class="fu">addProduct</span><span class="op">(</span><span class="va">name</span><span class="op">:</span> <span class="dt">String</span><span class="op">,</span> <span class="va">price</span><span class="op">:</span> <span class="dt">Double</span><span class="op">):</span> <span class="dt">Boolean</span> <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Validation (DUPLICATED)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>name<span class="op">.</span>isEmpty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Product name cannot be empty&quot;</span><span class="op">)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>name<span class="op">.</span>length <span class="op">&gt;</span> <span class="dv">50</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Product name too long&quot;</span><span class="op">)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>price <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Price cannot be negative&quot;</span><span class="op">)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>price <span class="op">&gt;</span> <span class="dv">100000</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Price exceeds maximum allowed&quot;</span><span class="op">)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        products<span class="op">.</span>add<span class="op">(</span>Pair<span class="op">(</span>name<span class="op">,</span> price<span class="op">))</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        println<span class="op">(</span><span class="st">&quot;Product added: </span><span class="ss">$name</span><span class="st"> at £</span><span class="ss">$price</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">true</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fun</span> <span class="fu">updateProduct</span><span class="op">(</span><span class="va">index</span><span class="op">:</span> <span class="dt">Int</span><span class="op">,</span> <span class="va">name</span><span class="op">:</span> <span class="dt">String</span><span class="op">,</span> <span class="va">price</span><span class="op">:</span> <span class="dt">Double</span><span class="op">):</span> <span class="dt">Boolean</span> <span class="op">{</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>index <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> index <span class="op">&gt;=</span> products<span class="op">.</span>size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Invalid product index&quot;</span><span class="op">)</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Same validation DUPLICATED here</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>name<span class="op">.</span>isEmpty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Product name cannot be empty&quot;</span><span class="op">)</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>name<span class="op">.</span>length <span class="op">&gt;</span> <span class="dv">50</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Product name too long&quot;</span><span class="op">)</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>price <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Price cannot be negative&quot;</span><span class="op">)</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>price <span class="op">&gt;</span> <span class="dv">100000</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            println<span class="op">(</span><span class="st">&quot;Error: Price exceeds maximum allowed&quot;</span><span class="op">)</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        products<span class="op">[</span>index<span class="op">]</span> <span class="op">=</span> Pair<span class="op">(</span>name<span class="op">,</span> price<span class="op">)</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        println<span class="op">(</span><span class="st">&quot;Product updated: </span><span class="ss">$name</span><span class="st"> at £</span><span class="ss">$price</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">true</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="kw">fun</span> <span class="fu">main</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> <span class="va">manager</span> <span class="op">=</span> ProductManager<span class="op">()</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Test cases</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>addProduct<span class="op">(</span><span class="st">&quot;Laptop&quot;</span><span class="op">,</span> <span class="fl">899.99</span><span class="op">)</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>addProduct<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">,</span> <span class="fl">50.0</span><span class="op">)</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>addProduct<span class="op">(</span><span class="st">&quot;Very Long Product Name That Exceeds The Maximum Length Allowed&quot;</span><span class="op">,</span> <span class="fl">100.0</span><span class="op">)</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>updateProduct<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Gaming Laptop&quot;</span><span class="op">,</span> <span class="fl">1299.99</span><span class="op">)</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>updateProduct<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Product&quot;</span><span class="op">,</span> <span class="op">-</span><span class="fl">50.0</span><span class="op">)</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Your Task:</strong></p>
<p>Refactor the code above by: 1. Creating a
<code>validateProductName()</code> method that returns a Boolean 2.
Creating a <code>validateProductPrice()</code> method that returns a
Boolean 3. Using these methods in both <code>addProduct()</code> and
<code>updateProduct()</code></p>
<p><strong>Expected Output:</strong></p>
<pre><code>Product added: Laptop at £899.99
Error: Product name cannot be empty
Error: Product name too long
Product updated: Gaming Laptop at £1299.99
Error: Price cannot be negative</code></pre>
<hr />
<h3 id="task-2-apply-encapsulation">Task 2: Apply Encapsulation</h3>
<p>The following code violates encapsulation principles. Your task is to
refactor it to properly encapsulate the collection and provide
controlled access.</p>
<p><strong>Starting Code:</strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Library <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Public mutable list - anyone can modify it!</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> <span class="va">books</span> <span class="op">=</span> mutableListOf<span class="op">&lt;</span><span class="kw">String</span><span class="op">&gt;()</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fun</span> <span class="fu">printLibrary</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        println<span class="op">(</span><span class="st">&quot;Library contains </span><span class="ss">${</span>books<span class="op">.</span>size<span class="ss">}</span><span class="st"> books:&quot;</span><span class="op">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        books<span class="op">.</span>forEach <span class="op">{</span> println<span class="op">(</span><span class="st">&quot;  - </span><span class="ss">$it</span><span class="st">&quot;</span><span class="op">)</span> <span class="op">}</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="kw">fun</span> <span class="fu">main</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> <span class="va">library</span> <span class="op">=</span> Library<span class="op">()</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Direct manipulation of the collection</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    library<span class="op">.</span>books<span class="op">.</span>add<span class="op">(</span><span class="st">&quot;1984&quot;</span><span class="op">)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    library<span class="op">.</span>books<span class="op">.</span>add<span class="op">(</span><span class="st">&quot;Brave New World&quot;</span><span class="op">)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    library<span class="op">.</span>printLibrary<span class="op">()</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Problem: anyone can do this!</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    library<span class="op">.</span>books<span class="op">.</span>clear<span class="op">()</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    println<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">After external modification:&quot;</span><span class="op">)</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    library<span class="op">.</span>printLibrary<span class="op">()</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Your Task:</strong></p>
<p>Refactor the <code>Library</code> class to: 1. Make the
<code>books</code> list private (use a backing field like
<code>_books</code>) 2. Provide a public read-only property that returns
a copy of the list 3. Create an <code>addBook(title: String)</code>
method with validation (title cannot be blank) 4. Create a
<code>removeBook(title: String)</code> method that returns Boolean 5.
Create a <code>getBookCount()</code> method</p>
<p><strong>Expected Output:</strong></p>
<pre><code>Added: 1984
Added: Brave New World
Library contains 2 books:
  - 1984
  - Brave New World
Error: Book title cannot be blank
Removed: Brave New World
Library contains 1 books:
  - 1984</code></pre>
<hr />
<p><strong>End of Worksheet</strong></p>
